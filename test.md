---
title: 자바스크립트 엔진 런타임 작동 방식, 동작 원리
date: '2023-11-24'
tags: ['study']
draft: false
summary: 자바스크립트 엔진 런타임 작동 방식, 동작 원리를 공부하여 정리한 글 입니다.
---

![header](https://capsule-render.vercel.app/api?type=rect&color=auto&text=%20%20STUDY%20%20&fontAlign=30&fontSize=15&textBg=true&desc=강의%20내용을%20바탕으로%20나의%20경험,생각을%20작성&descAlign=60&descAlignY=50&animation=twinkling)

### ⚠ 참고 사항

```javascript

import { useState } from "react";

export default function blogPage() {
 const [블로그 내용, 내가 적은 내용] = useState('나의 주관적 생각 + 잘못 이해한 내용')
  return (
    <article>
      {블로그 내용}
      // 관련 된 내용을 내가 직접 공부하여 정리한 내용!!
      // 주관적 생각과 나의 이해를 바탕으로 적은 글이라 정확하지 않을 수 있음
      // 추후의 내용이 추가 되거나 수정 될 수 있음
    </article>
  );
}

```

# 목차

[1. 개요](#개요)

[2. 자바스크립트 런타임](#자바스크립트-런타임)

[3. 자바스크립트 엔진](#자바스크립트-엔진)

[4. V8](#V8)

## 개요

<img
  src="https://d2.naver.com/content/images/2015/06/helloworld-59361-1.png"
  width="100%"
  height="300"
/>
&uarr; [렌더링 엔진](https://development-mark.vercel.app/blog/%EB%A0%8C%EB%8D%94%EB%A7%81%20%EC%97%94%EC%A7%84)

자바스크립트 엔진에 관련 된 내용을 좀더 깊게 다룰 예정 이며 그 중 Chrome의 V8엔진을 중심으로 포스팅 할 예정

https://github.com/v8/v8
https://evan-moon.github.io/2019/06/28/v8-analysis/
https://medium.com/@vdongbin/node-js-%EB%8F%99%EC%9E%91%EC%9B%90%EB%A6%AC-single-thread-event-driven-non-blocking-i-o-event-loop-ce97e58a8e21
https://hanamon.kr/javascript-%EB%9F%B0%ED%83%80%EC%9E%84-%EC%9E%91%EB%8F%99-%EB%B0%A9%EC%8B%9D-%EB%B9%84%EB%8F%99%EA%B8%B0%EC%99%80-%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EB%A3%A8%ED%94%84/
https://velog.io/@hang_kem_0531/JS-%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC

## 자바스크립트 런타임

- JavaScript가 구동되는 환경

- 종류로는 웹 브라우저(크롬, 파이어폭스) 와 NodeJs라는 프로그램이 존재 함

## 자바스크립트 엔진

- 기본적으로 컴퓨터는 0 or 1 밖에 이해하지 못하는 낮은 수준의 언어지만 자바스크립트 파일을 이해하고 명령을 수행하기 위해 등장

- 즉 자바스크립트 엔진은 자바스크립트 코드를 컴퓨터가 이해할 수 있게 기계어로 변환해서 실행하는 프로그램 또는 인터프리터

#### 📌 자바스크립트 런타임에서 비동기 처리 방법

<img
  src="https://images.velog.io/images/y_jem/post/100640f7-b1dc-48ed-916a-b63959146b2f/jsengine.png"
  width="100%"
  height="300"
/>

- 이벤트 루프는 이 전체 시스템에서 아주 단순한 일을 하는 작은 파트 (그러나 매우 중요)

- 이벤트 루프의 역할은 콜 스택과 콜백 큐를 주시

- 콜 스택이 비어있으면 큐의 첫 번째 콜백을 스택에 쌓아 효과적으로 실행할 수 있게 함

- 이벤트 루프는 콜 스택이 비어질 때까지 기다린 후 콜백 큐에 있는 콜백을 콜 스택에 넣어주는 역할 (싱글 스레드)

- Web API의 콜백이 완료되었다면 콜백은 큐에 쌓이게 되고, 이벤트 루프에 의해서 실행

✨이미지 처리나 애니메이션이 너무 잦아지거나 스택에 필요없이 느린 코드가 쌓이면 실행 속도의 영향이 감

## V8

- V8 엔진은 Google이 개발한 오픈소스로 가장 대중적인 자바스크립트 엔진

- Nodejs 런타임, Chrome Browser에서 사용

- C++로 구성, 개발 (컴파일러)

### V8 엔진 구조

- 자바스크립트 V8 엔진 소스 안에는 하나의 힙과 하나의 콜 스택

- setTimeout, DOM, AJAX(HTTP 요청)등과 같은 비동기 메소드가 없음 -> 이를 도와주는 자바스크립트 런타임인 Web APIs(setTimeout, DOM, AJAX(HTTP 요청)) 와 이벤트 루프와 콜백 큐를 가짐

#### ✨V8을 더 이해하기 위한 필요한 지식

- 자바스크립트는 싱글 스레드(single thread = 한 가닥)
  <img
    src="https://d2.naver.com/content/images/2015/06/helloworld-59361-1.png"
    width="100%"
    height="300"
  />
  - 바늘 구멍에 실을 꿰는 것 처럼 한 가지 작업을 실행하기 위해 순차적으로 진행 시켜야 함 (실제로 코드를 실처럼 이어 놓았다고 해서 유래된 이름)
  - 싱글 스레드란 하나의 프로그램에서 동시에 하나의 코드만 실행할 수 있다는 뜻

#### 콜 스택(Call Stack)과 메모리 힙(Memory Heap)

<img
  src="https://images.velog.io/images/y_jem/post/100640f7-b1dc-48ed-916a-b63959146b2f/jsengine.png"
  width="100%"
  height="300"
/>

- V8 엔진에는 두 가지 주요 구성 요소로 콜 스택과 메모리 힙이 존재

- **콜 스택** : 코드 실행에 따라 호출 스택이 쌓이는 곳. 자바스크립트 엔진은 단 하나의 호출 스택을 사용

- 메모리 힙 : 자바스크립트에서 사용되는 메모리 공간

- 콜 스택은 코드를 읽고 함수가 실행되는 순서를 기억

- 자바스크립트는 싱글 스레드 프로그래밍 언어이며 하나의 힙 영역과 하나의 콜 스택을 가지므로 한 가지 일 밖에 하지 못함

- 콜 스택은 실행 컨텍스트 과정과 매우 유사

### 그렇다면 Google은 자바스크립트 엔진 대신 V8 엔진을 만들었을까?

- 그 이유를 알기 위해서는 컴파일러 와 인터프릿에 대한 이해가 필요 함

#### 인터프리터(Interpreter) vs. 컴파일러(Compiler)

- 인터프리터

  - Interpret 라는 단어는 "해석하다"라는 뜻으로 **프로그램 실행시 한 번에 한 문장씩만 기계어로 번역**

  - 컴파일러와 다르게 한번에 한 문장씩 읽고 번역하여 실행시키는 과정을 반복하다보니 실행이 조금 느리지만 메모리 효율이 좋음

  - 한번에 한 문장씩 읽기때문에 프로그램을 실행해봐야지만 오류 발견이 가능하지만 코드 변경시 빌드 과정없이 바로 실행이 가능 하므로 개발 속도가 빠르다는 장점이 있음

- 컴파일러

  - Compile 이라는 단어는 "무언가를 모아서 묶음으로 만든다" 라는 뜻으로 **프로그램 전체를 스캔하여 이를 모두 기계어로 한번에 번역**

  - 모든 파일을 스캔하기 때문에 초기 스캔시간이 오래걸리지만 인터프리터보다 속도가 빠름

  - 인터프리터 보다 메모리를 많이 사용하지만 전체 코드를 검사한 후에 실행 하기 때문에 실행 전 오류 발견 가능

- 기존 자바스크립 엔진은 웹 특성상 유저와 상호작용을 위해 즉시성이 있는 인터프리터 방식을 사용하는데, 이는 코드가 많아질수록 속도가 느려진다는 단점이 있었음

**인터프리터의 장점과 컴파일러의 장점을 합친 JIT Compiler을 지원(하이브리드 형식)하는 형식의 V8을 개발**

- 이로 인하여 자바스크립트의 성능을 크게 향상 시킴

## V8 엔진의 작동원리

[^1]: `인터프리터`란 자바스크립트 파일을 입력받으면 코드를 한 줄 한 줄 해석하면서 기계어로 번역하는 방식
[^2]: `자바스크립트 엔진`란 자바스크립트 코드를 실행하는 프로그램을 말하며 주로 구글의 v8 엔진
[^3]: `선언`란 메모리 공간을 확보하고 식별자와 연결 즉 정체를 알리는 행위
[^4]: `초기화`란 별자에 암묵적으로 undefined 값으로 바인딩하는 것 즉 공간을 확보해서 거기에 undefined라는 임의의에 값을 넣는 행위
[^5]: `할당`란 을 선언된 변수에 개발자가 지정한 값을 넣는 것 즉 임의의 undefined 값을 원하는 값으로 바꾸는 행위
[^6]: `TDZ`란 일시적 사각지대(Temporal Dead Zone)
[^7]: `스코프`란 참조 대상 식별자를 찾아내기 위한 규칙으로 식별자를 구분하고 찾음
[^8]: `전역 스코프(Global scope)`란 스크립트 전체에서 참조되는 것을 의미하며, 어느 곳에서든 참조
[^9]: `지역 스코프(Local scope)`란 함수 코드 블록이 만든 스코프. 함수 자신과 하위 함수에서만 참조 가능. 블록 내부 영역(Block-level Scope)도 지역 스코프
[^10]: `LHS(left-hand side) 참조`란 변수가 대입 연산자(=)의 왼쪽에 있을 때 참조하여 값을 넣을 변수를 찾는 행위 즉 이게 함수인지 변수인지를 찾음
[^11]: `RHS(right-hand side) 참조`란 변수가 대입 연산자(=)의 왼쪽이 아닌 편에 있을 때 수행하는 참조 행위로 즉 여기에 들어 가는 값에 대한 출처를 찾음
[^12]: `중첩 스코프`란 변수를 현재 스코프에서 발견하지 못하면 엔진은 다음 바깥의 스코프로 넘어가는 방식으로 변수를 찾거나 글로벌 스코프로 불리는 가장 바깥 스코프에 도달할 때까지 반복하는 과정
[^13]: `function-level scope`란 함수 코드 블럭 내에서 선언된 변수는 함수 코드 블럭 내에서만 유효하고 함수 외부에서는 유효하지 않음 단 let,const 를 사용하면 block-level 가능
[^14]: `변수명 중복 허용`란 글로벌 영역에 변수를 선언하면 이 변수는 어느 곳에서든지 참조할 수 있는 global scope를 갖는 전역 변수가 가능
[^15]: `암묵적 전역`란 명시적으로 변수 앞에 var를 붙여주지 않으면 암묵적 전역변수가 되어 값을 참조할 수 있음
